# Authorization Service

## Описание

Проект представляет собой реализацию простой реферальной системы. Основной функционал включает авторизацию пользователей по номеру телефона и возможность использования инвайт-кодов.

При первом запросе на авторизацию, пользователю будет предложено ввести свой номер телефона. Затем, на сервере будет имитирована отправка 4-значного кода авторизации с задержкой 1-2 секунды. Во втором запросе пользователю нужно будет ввести полученный код.

Если пользователь ранее не авторизовывался, его данные будут сохранены в базе данных.

В профиле пользователя будет доступна возможность ввода чужого инвайт-кода, который будет проверен на его существование. При первой авторизации пользователю будет присвоен рандомно сгенерированный 6-значный инвайт-код, состоящий из цифр и символов.

Также в профиле пользователя будет отображаться список пользователей (номеров телефонов), которые ввели его инвайт-код. Пользователь сможет активировать только один инвайт-код в своем профиле. Если пользователь уже активировал инвайт-код ранее, его код будет отображаться в соответствующем поле запроса на профиль пользователя.

Все функции доступны через API.

# API Эндпоинты (API Endpoints)

## 1. Получение кода верификации

- **Метод**: ```POST```
- **URL**: ```/user-login/```

### Параметры запроса

- ```phone_number``` (string): Номер телефона пользователя. В формате +79999999999.

### Ответ

- **Статус код 200**: Успешный запрос. Код авторизации отправлен на указанный номер телефона. **Сообщение**: Введите верификационный код из СМС для входа POST /input_verification_code/

### Возможные ошибки
- **Статус код 400**: Ошибка валидации номера телефона. **Сообщение**: Введите номер телефона в формате +79999999999.

### Пример корректного запроса

```POST /user-login/```
```json
{
   "phone_number": "+79999999999"
}
```

## 2. Авторизация через введение кода верификации

- **Метод**: ```POST```
- **URL**: ```/input_verification_code/```

### Параметры запроса

- ```phone_number``` (string): Номер телефона пользователя. В формате +79999999999.
- ```entered_code``` (string): Код верификации из СМС

### Ответ

- **Статус код 200**: Успешный запрос. Код прошёл проверку. Вы авторизованы (вам выдан токен на авторизацию) **Сообщение**: Вход выполнен успешно.

### Возможные ошибки

- **Статус код 400**: Ошибка валидации номера телефона. **Сообщение**: Введите номер телефона в формате +79999999999.
- **Статус код 400**: Ошибка при неверном коде верификации. **Сообщение**: Неверный код верификации.
- **Статус код 400**: Ошибка при отсутствии кода верификации для указанного номера телефона в базе. **Сообщение**: Отсутствует код верификации.

### Пример корректного запроса

```POST /input_verification_code/```
```json
{
    "phone_number": "+79996661515",
    "entered_code": "3030"
}
```

## 3. Список всех профилей пользователей с указанием их рефералов

- **Метод**: ```GET```
- **URL**: ```/userprofiles/```


### Ответ

- **Статус код 200**: Успешный запрос. Выводит список профилей всех пользователей. По 5 на страницу.

### Возможные ошибки

- **Статус код 401**: Ошибка авторизации. Для просмотра необходимо авторизоваться.

### Пример корректного запроса

```
GET /userprofiles/
```

### Пример ответа на корректный запрос

```json
{
    "count": 2,
    "next": null,
    "previous": null,
    "results": [
        {
            "id": 2,
            "phone_number": "+79530781542",
            "user_referral_code": "YU0I4D",
            "user_referred_code_used": true,
            "referred_users": [],
            "activated_referral_code": null,
            "referred_by": null
        },
        {
            "id": 3,
            "phone_number": "+79996661515",
            "user_referral_code": "DM8B52",
            "user_referred_code_used": false,
            "referred_users": [],
            "activated_referral_code": "YU0I4D",
            "referred_by": "+79530781542"
        }
    ]
}
```

## 4. Просмотр профиля пользователя с указанием их рефералов

- **Метод**: ```GET```
- **URL**: ```/userprofiles/userprofile_id/```


### Ответ

- **Статус код 200**: Успешный запрос. Выводит профиль пользователя.

### Возможные ошибки

- **Статус код 401**: Ошибка авторизации. Для просмотра необходимо авторизоваться.
- **Статус код 403**: Ошибка прав доступа, если пытаться редактировать чужой профиль. **Сообщение**: Вы не можете изменять и просматривать чужие профили.

### Пример корректного запроса

```
GET /userprofiles/userprofile_id/
```

### Пример ответа на корректный запрос

```json
{
    "id": 3,
    "phone_number": "+79996661515",
    "user_referral_code": "DM8B52",
    "user_referred_code_used": false,
    "referred_users": [],
    "activated_referral_code": "YU0I4D",
    "referred_by": "+79530781542"
}
```

## 5. Ввод реферального кода в своём профиле

- **Метод**: ```PUT```
- **URL**: ```/userprofiles/userprofile_id/```

### Параметры запроса

- ```referral_code``` (string): Реферальный код

### Ответ

- **Статус код 200**: Успешный запрос. **Сообщение**: Вы успешно стали рефералом.

### Возможные ошибки

- **Статус код 400**: Ошибка при вводе кода. **Сообщение**: Неверный реферальный код.
- **Статус код 400**: Ошибка, если реферальный код уже был введён ранее. **Сообщение**: У вас уже активирован реферальный код.
- **Статус код 400**: Ошибка при вводе своего же реферального кода, а не чужого. **Сообщение**: Вы не можете использовать свой собственный реферальный код.
- **Статус код 403**: Ошибка прав доступа, если пытаться редактировать чужой профиль. **Сообщение**: Вы не можете изменять и просматривать чужие профили.
- **Статус код 404**: Ошибка поиска в базе введённого реферального кода. Профиля с таким реферальным кодом не существует. **Сообщение**: Страница не найдена.

### Пример корректного запроса
```PUT /userprofiles/userprofile_id/```
```json
{
  "referral_code": "YU0I4D"
}
```

## 6. Создание профилей

Данная операция не доступна. Создать пользователя можно только через ```/user-login/```.

- **Метод**: ```POST```
- **URL**: ```/userprofiles/```

### Ответ
- **Статус код 403**: Ошибка прав доступа. **Сообщение**: У вас недостаточно прав для выполнения данного действия.

## 7. Удаление профилей

Данная операция доступна только админам.

- **Метод**: ```DELETE```
- **URL**: ```/userprofiles/userprofile_id/```

### Ответ
- **Статус код 403**: Ошибка прав доступа. **Сообщение**: У вас недостаточно прав для выполнения данного действия.


## 8. Авторизация

- **Метод**: ```GET```
- **URL**: ```/users/token/``` и ```/users/token/refresh/```

## 9. Документация

Доступна в двух форматах.

- **URL**: ```/swagger/``` и ```/redoc/```

# Установка через DOCKER

1. Клонирование репозитория ```git clone https://github.com/fniad/authorization_service.git```
2. ```cd authorization_service```
3. ```touch .env```
```nano .env```
и заполнить по шаблону из **.env.test**
4. ```touch .env.docker```
```nano .env.docker```
и заполнить по шаблону из **.env.docker.test**
5. На Ubuntu или Linux сначала остановить postgresql ```systemctl stop postgresql```
6. ```docker-compose build```
7. ```docker-compose up```


# Использование

Это API можно использовать в различных контекстах, где необходима реализация реферальной системы и авторизации по номеру телефона. 

Вот несколько примеров использования:

### 1. Мобильное приложение
Можно использовать API для разработки мобильного приложения, предоставляющего пользователям простой и удобный способ регистрации и авторизации через номер телефона. Реферальная система добавит элемент социальной активности.

### 2. Веб-платформа для реферальных программ
Подойдёт для веб-платформы, где пользователи могут зарегистрироваться, получить свой инвайт-код и пригласить друзей. API может использоваться для обработки регистрации, отправки кода авторизации и управления реферальной структурой.

### 3. Сервис внутренней коммуникации
В офисной или корпоративной среде можно использовать API для разработки внутреннего сервиса обмена контактами с возможностью реферальных программ. Это может поощрять команды и коллег внутри организации.

### 4. Платформа для мероприятий
Подойдёт для платформы мероприятий, где участники могут регистрироваться и приглашать других. Используйте API для управления авторизацией и реферальной системой.


### 5. Анализ и отслеживание активности
Можно использовать API для анализа активности пользователей, отслеживания успешных регистраций и взаимодействий с реферальной системой.

### 6. Интеграция в любой существующий проект
Если у вас уже есть проект и вы хотите добавить функции авторизации и реферальной системы, API может быть интегрировано для расширения функциональности. 

